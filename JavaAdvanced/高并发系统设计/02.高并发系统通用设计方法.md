# 高并发系统通用设计方法

------

## 本节概述

- 了解高并发系统设计的三种通用方法

## 主要内容

### 高并发系统通用设计方法

应对高并发大流量时，会采用类似“抵御洪水”的方案，有三种方案：

#### Scale-out（横向扩展）

##### 定义

分而治之是一种常见的高并发系统设计方法，采用分布式部署的方式把流量分流开，让每个服务器都承担一部分并发和流量。

对应 Scale-out（横向扩展）还存在一个 Scale-up（纵向扩展），Scale-up 类似追逐摩尔定律不断提升CPU性能的方案。

通俗的讲，Scale-up 可以理解为通过购买性能更好的硬件来提升系统的并发处理能力，而 Scale-out 可以理解为通过将多个低性能的机器组成一个分布式集群来共同抵御高并发流量的冲击。

##### 如何选择 Scale-up 和 Scale-out 

一般情况下，在系统设计初期会考虑使用 Scale-up ，简单，直接通过堆铁就可以解决问题。但当系统问题超过单机的极限时，就需要使用 Scale-out 了。

##### 衍生问题思考

此处我们需要思考的是，Scale-out 虽然能够突破单机极限，但是也会引入一系列问题。比如，如果某个节点出现故障，如何保证整体可用性？当多个节点有状态需要同步时如何保证状态信息在不同节点的一致性？如何做到使用方无感知的增加和删除节点？



#### 缓存

缓存遍布在系统设计的每个角落，从操作系统到浏览器，从数据库到消息队列。使用缓存的主要作用是提升系统的访问性能，在高并发的场景下就可以支撑更多用户的同时访问。

任何降低响应时间的中间存储都可以称为缓存。



#### 异步

以方法调用为例，同步调用代表调用方要阻塞等待被调用方法中的逻辑执行完成。这种方式下，当被调用方法响应时间较长时，会造成调用方长久的阻塞，在高并发下会造成整体系统性能下降甚至发生雪崩。**异步**则相反，调用方不需要等待方法逻辑执行完成就可以返回执行其他的逻辑，在被调用方法执行完毕后再通过回调、事件通知等方式将结果反馈给调用方。

在某些场景下，未处理完成之前我们可以让请求先返回，在数据准备好之后再通知请求方，这样可以在单位时间内处理更多的请求。



## 本节总结

高并发系统的演进应该是循序渐进，以解决系统中存在的问题为目的和驱动力的。

## 知识拓展

### 相关文章推荐

### 知识点拓展

1. 一般系统的演进过程应该遵循下面的思路：
    - 最简单的系统设计满足业务需求和流量现状，选择最熟悉的技术体系。
    - 随着流量的增加和业务的变化修正架构中存在问题的点，如单点问题、横向扩展问题、性能无法满足需求的组件。在这个过程中，选择社区成熟的、团队熟悉的组件帮助我们解决问题，在社区没有合适解决方案的前提下才会自己造轮子。
    - 当对架构的小修小补无法满足需求时，考虑重构、重写等大的调整方式以解决现有的问题。

