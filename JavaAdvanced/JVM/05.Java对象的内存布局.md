# Java对象的内存布局

------

## 本节概述

学习 Java 虚拟机构造对象的方式，所构造对象的大小，以及对象的内存布局。

## 主要内容



当我们调用一个构造器时，它将优先调用父类的构造器，直至 Object 类。这些构造器的调用者皆为同一对象，也就是通过 new 指令新建而来的对象。

#### 压缩指针

在 Java 虚拟机中，每个 Java 对象都有一个对象头（object header），这个由**标记字段**和**类型指针**所构成。其中，标记字段用以存储 Java 虚拟机有关该对象的运行数据，如哈希码、GC 信息以及锁信息，而类型指针则指向该对象的类。

为了尽量较少对象的内存使用量，64 位 Java 虚拟机引入了压缩指针的概念（对应虚拟机选项 -XX:+UseCompressedOops，默认开启），将堆中原本 64 位的 Java 对象指针压缩成 32 位的。



##### 内存对齐

（对应虚拟机选项 -XX:ObjectAlignmentInBytes，默认值为 8）

字段内存对齐的其中一个原因，是让字段只出现在同一 CPU 的缓存行中。如果字段不是对齐的，那么就有可能出现跨缓存行的字段。也就是说，该字段的读取可能需要替换两个缓存行，而该字段的存储也会同时污染两个缓存行。这两种情况对程序的执行效率而言都是不利的。

##### 对象间的填充

默认情况下，Java 虚拟机堆中对象的起始地址需要对齐至 8 的倍数。如果一个对象用不到 8N 个字节，那么空白的那部分空间就浪费掉了。这些浪费掉的空间我们称之为对象间的填充（padding）。

#### 字段重排列









## 本节总结

常见的 new 语句会被编译为 new 指令，以及对构造器的调用。每个类的构造器皆会直接或间接调用父类的构造器，并且在同一个实例中初始化相应的字段。











## 知识拓展

### 相关文章推荐

### 知识点拓展

