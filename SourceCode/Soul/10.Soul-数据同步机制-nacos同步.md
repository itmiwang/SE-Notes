# Soul-数据同步机制-nacos同步

------

## 本节概述

- 熟悉 `soul` 的数据同步机制中的 `nacos` 同步

## 主要内容

关于什么是数据同步，以及同步策略的原理分析，请阅读[Soul-数据同步机制-websocket同步](https://github.com/itmiwang/SE-Notes/blob/main/SourceCode/Soul/07.Soul-%E6%95%B0%E6%8D%AE%E5%90%8C%E6%AD%A5%E6%9C%BA%E5%88%B6-websocket%E5%90%8C%E6%AD%A5.md)。



### 本地启动 Nacos

本地启动 `Nacos` ，请参考 [soul-examples-springcloud 体验中的本地启动 Nacos 模块](https://github.com/itmiwang/SE-Notes/blob/main/SourceCode/Soul/06.soul-examples-springcloud%E4%BD%93%E9%AA%8C.md)。



### Nacos同步策略-配置

#### soul-bootstrap 配置

在 `soul-bootstrap` 项目的 `pom.xml` 文件中引入了 `soul-spring-boot-starter-sync-data-nacos` 这个 `starter` 。

```xml
<!--soul data sync start use nacos-->
<dependency>
    <groupId>org.dromara</groupId>
    <artifactId>soul-spring-boot-starter-sync-data-nacos</artifactId>
    <version>${project.version}</version>
</dependency>
```

所以在 `soul-bootstrap` 启动后，就会去寻找 `soul-spring-boot-starter-sync-data-nacos` 包 `resources/META-INF/spring.factories` 文件，然后根据文件中的配置去加载指定模块。`spring.factories` 的文件内容如下：

```
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.dromara.soul.springboot.starter.sync.data.nacos.NacosSyncDataConfiguration
```

在 `soul-bootstrap` 项目的 `application-local.yml` 文件中，配置了

```yaml
soul:
  sync:
    nacos:
      url: localhost:8848
        namespace: 1c10d748-af86-43b9-8265-75f487d20c6c
        acm:
          enabled: false
          endpoint: acm.aliyun.com
          namespace:
          accessKey:
          secretKey:
```

启动 `soul-bootstrap` 项目后，控制台打印内容如下：

```
2021-01-26 01:43:41.730  INFO 27971 --- [           main] d.s.s.s.s.d.n.NacosSyncDataConfiguration : you use nacos sync soul data.......
```



#### soul-admin 配置

在 `soul-admin` 项目中的 `application.yml` 文件中配置 `nacos` 同步的相关配置如下：

```yaml
soul:
  sync:
    nacos:
      url: localhost:8848
      namespace: 1c10d748-af86-43b9-8265-75f487d20c6c
```

启动 `soul-admin` 项目。



## 问题记录

刚开始启动 `soul-bootstrap` 项目，控制台并未成功打印日志 `you use nacos sync soul data.......` ，先初步排查了一下 `soul-bootstrap` 项目的 Maven 依赖，发现并没有 `org.dromara:soul-spring-boot-starter-sync-data-nacos:2.2.1` ，这里我们先进入 `soul-bootstrap` 项目目录下执行 `mvn clean package install -Dmaven.test.skip=true -Dmaven.javadoc.skip=true -Drat.skip=true -Dcheckstyle.skip=true` ，然后在 IDEA 中点击 `Reimport All Maven Projects` 按钮即可重新加载上 `nacos` 的依赖。

## 知识拓展

### 相关文章推荐

### 知识点拓展



